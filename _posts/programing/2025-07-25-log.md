---
layout: post
title: "Ghi nhật ký và quản lý nhật ký"
date: 2025-07-24 10:00:00 +0700
categories: [Programing]
---

## Dữ liệu nhật ký

<div style="text-align: justify; text-indent: 2em;">
Dữ liệu nhật ký là ý nghĩa nội tại của một thông điệp nhật ký. Hay nói cách khác, dữ liệu nhật ký là thông tin được trích xuất từ một thông điệp nhật ký để cho bạn biết lý do tại sao thông điệp nhật ký đó được tạo ra. Ví dụ: máy chủ Web thường ghi lại bất cứ khi nào ai đó truy cập vào một tài nguyên (hình ảnh, tệp, v.v.) trên một trang Web. Nếu người dùng truy cập trang phải xác thực, thông điệp nhật ký sẽ chứa tên người dùng. Đây là một ví dụ về dữ liệu nhật ký: bạn có thể sử dụng tên người dùng để xác định ai đã truy cập vào một tài nguyên.
</div>

<div style="text-align: justify; text-indent: 2em;">
Tin nhắn nhật ký có thể được phân loại thành các loại chung sau:
</div>

### Thông tin

<div style="text-align: justify; text-indent: 2em;">
Các thông báo loại này được thiết kế để thông báo cho người dùng và quản trị viên biết rằng có sự cố vô hại đã xảy ra. Ví dụ: Cisco IOS sẽ tạo thông báo khi hệ thống được khởi động lại. Tuy nhiên, cần hết sức cẩn thận. Ví dụ, nếu việc khởi động lại xảy ra ngoài giờ bảo trì hoặc giờ làm việc thông thường, bạn có thể có lý do để lo lắng. Các chương tiếp theo của cuốn sách này sẽ cung cấp cho bạn các kỹ năng và kỹ thuật để có thể phát hiện khi sự cố tương tự xảy ra.
</div>

### Gỡ lỗi

<div style="text-align: justify; text-indent: 2em;">
Thông báo gỡ lỗi thường được tạo ra từ các hệ thống phần mềm để hỗ trợ các nhà phát triển phần mềm khắc phục sự cố và xác định các vấn đề khi chạy mã ứng dụng.
</div>

### Cảnh báo

<div style="text-align: justify; text-indent: 2em;">
Thông báo cảnh báo liên quan đến các tình huống mà hệ thống có thể thiếu hoặc cần một số thứ, nhưng việc thiếu chúng sẽ không ảnh hưởng đến hoạt động của hệ thống. Ví dụ: nếu một chương trình không được cung cấp đủ số lượng đối số dòng lệnh cần thiết, nhưng vẫn có thể chạy mà không cần chúng, thì chương trình có thể ghi lại thông tin này như một cảnh báo cho người dùng hoặc người vận hành.
</div>

### Lỗi

<div style="text-align: justify; text-indent: 2em;">
Thông báo nhật ký lỗi được sử dụng để chuyển tiếp các lỗi xảy ra ở nhiều cấp độ khác nhau trong hệ thống máy tính. Ví dụ: hệ điều hành có thể tạo nhật ký lỗi khi không thể đồng bộ hóa bộ đệm với ổ đĩa. Đáng tiếc là nhiều thông báo lỗi chỉ cung cấp cho bạn điểm khởi đầu về lý do tại sao chúng xảy ra. Thông thường, cần phải điều tra thêm để tìm ra nguyên nhân gốc rễ của lỗi.
</div>

### Báo động

<div style="text-align: justify; text-indent: 2em;">
Cảnh báo được dùng để chỉ ra điều gì đó thú vị đã xảy ra. Nhìn chung, cảnh báo là phạm vi hoạt động của các thiết bị bảo mật và hệ thống liên quan đến bảo mật, nhưng đây không phải là một quy tắc cứng nhắc. Hệ thống Phòng chống Xâm nhập (IPS) có thể được đặt trực tuyến trên mạng máy tính, kiểm tra tất cả lưu lượng truy cập đến. Nó sẽ quyết định xem một kết nối mạng nhất định có được phép đi qua hay không dựa trên nội dung của dữ liệu gói tin. Nếu IPS gặp phải một kết nối có khả năng độc hại, nó có thể thực hiện bất kỳ hành động nào được cấu hình sẵn. Quyết định này, cùng với hành động đã thực hiện, sẽ được ghi lại.
</div>

## Dữ liệu nhật ký được truyền và thu thập như thế nào?

<div style="text-align: justify; text-indent: 2em;">
Việc truyền và thu thập dữ liệu nhật ký về mặt khái niệm rất đơn giản. Máy tính hoặc thiết bị triển khai một hệ thống ghi nhật ký con, nhờ đó nó có thể tạo ra một thông báo bất cứ khi nào nó xác định là cần thiết. Cách thức xác định chính xác phụ thuộc vào thiết bị. Ví dụ: bạn có thể có tùy chọn cấu hình thiết bị hoặc thiết bị có thể được mã hóa cứng để tạo ra một danh sách thông báo được thiết lập sẵn. Mặt khác, bạn phải có một nơi để gửi và thu thập thông báo nhật ký. Nơi này thường được gọi là loghost. Loghost là một hệ thống máy tính, thường là hệ thống Unix hoặc máy chủ Windows, nơi các thông báo nhật ký được thu thập tại một vị trí trung tâm.
</div>

<div style="text-align: justify; text-indent: 2em;">
Những lợi ích khi sử dụng bộ thu thập nhật ký trung tâm như sau:
</div>

- Đây là nơi tập trung để lưu trữ thông điệp nhật ký từ nhiều vị trí.
- Đây là nơi lưu trữ các bản sao lưu nhật ký của bạn.
- Đây là nơi có thể thực hiện phân tích trên dữ liệu nhật ký của bạn.

## Tin nhắn nhật ký là gì?

<div style="text-align: justify; text-indent: 2em;">
Tin nhắn nhật ký là thứ được tạo ra bởi một số thiết bị hoặc hệ thống để biểu thị rằng có điều gì đó đã xảy ra.
</div>

<div style="text-align: justify; text-indent: 2em;">
Trước hết, nội dung cơ bản điển hình của một tin nhắn nhật ký như sau:
</div>

- Dấu thời gian.
- Nguồn.
- Dữ liệu.

## Chính sách lưu giữ nhật ký

<div style="text-align: justify; text-indent: 2em;">
Việc xây dựng chính sách lưu trữ nhật ký sẽ đặt nền tảng cho việc xem xét các chủ đề lưu trữ được đề cập trong chương này. Chính sách mà bạn thiết kế cho tổ chức của mình sẽ quyết định nhiều quyết định cần đưa ra về loại hình lưu trữ, kích thước, chi phí, tốc độ truy xuất, cũng như các yêu cầu lưu trữ và hủy bỏ cho dữ liệu nhật ký của bạn.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bạn cần xem xét các mục sau đây khi xây dựng chính sách lưu giữ nhật ký:
</div>

### Đánh giá các yêu cầu tuân thủ hiện hành

<div style="text-align: justify; text-indent: 2em;">
Ngày nay, nhiều ngành công nghiệp đang áp dụng một số yêu cầu tuân thủ nghiêm ngặt. Ví dụ bao gồm Tiêu chuẩn Bảo mật Dữ liệu Ngành Thẻ Thanh toán (PCI DSS) với thời hạn lưu trữ nhật ký rất cụ thể là một năm, mục 10.7 của PCI DSS (Hội đồng Tiêu chuẩn Bảo mật PCI, 2010), các quy định của Tập đoàn Điện lực Độ tin cậy Bắc Mỹ (NERC) đề cập đến thời hạn cụ thể cho từng loại nhật ký; các quy định khác yêu cầu lưu trữ các loại nhật ký cụ thể nhưng không nêu rõ thời hạn. Hướng dẫn này giúp đặt nền tảng và các yêu cầu tối thiểu cho chính sách lưu trữ.
</div>

### Xem xét lại tình hình rủi ro của tổ chức

<div style="text-align: justify; text-indent: 2em;">
Rủi ro nội bộ và rủi ro bên ngoài quyết định thời gian lưu trữ cho các bộ phận khác nhau trong mạng của bạn. Thời gian và tầm quan trọng của nhật ký có thể rất khác nhau tùy thuộc vào từng khu vực rủi ro này đối với một tổ chức. Hãy nhớ rằng nếu bạn tập trung sử dụng nhật ký để điều tra các mối đe dọa nội bộ, thời gian lưu trữ cần phải dài hơn, vì những sự cố như vậy thường không được phát hiện trong nhiều năm, nhưng khi được phát hiện, sẽ gây ra nhu cầu cấp thiết phải "đi đến tận cùng của vấn đề!"
</div>

### Xem xét các nguồn nhật ký khác nhau và kích thước của các nhật ký được tạo ra

<div style="text-align: justify; text-indent: 2em;">
Tường lửa, máy chủ, cơ sở dữ liệu, proxy web—không chỉ dựa trên nhu cầu mà còn dựa trên khối lượng nhật ký điển hình, kích thước và loại của mỗi bản ghi nhật ký được tạo ra. Có rất nhiều loại nhật ký bạn sẽ nhận được từ mỗi loại thiết bị hoặc ứng dụng. Ví dụ: nhật ký từ tường lửa chính sẽ tạo ra một khối lượng nhật ký khổng lồ và do đó rất có thể chỉ nên được lưu trữ trong 30 ngày do yêu cầu lưu trữ lâu dài đối với dữ liệu nhật ký này. Tuy nhiên, nhu cầu tuân thủ của tổ chức, chẳng hạn như PCI DSS, và mức độ quan trọng của tường lửa chính nên được đánh giá chặt chẽ để xác định xem có cần thời gian lưu trữ lâu hơn hay không. Ngoài ra, bạn có thể có các nguồn nhật ký tạo ra các nhật ký mà bạn không có các công cụ cần thiết để phân tích nhật ký, chẳng hạn như các ứng dụng tùy chỉnh và hệ điều hành không được hỗ trợ.
</div>

### Xem lại các tùy chọn lưu trữ có sẵn

<div style="text-align: justify; text-indent: 2em;">
Các tùy chọn lưu trữ nhật ký bao gồm đĩa, DVD, WORM, băng, RDBMS, lưu trữ nhật ký chuyên biệt và lưu trữ đám mây. Quyết định về điều này chủ yếu dựa trên giá cả, dung lượng và tốc độ truy cập, và điều rất quan trọng là khả năng truy cập đúng bản ghi nhật ký trong một khoảng thời gian hợp lý. Băng được biết đến là một lựa chọn rẻ tiền, nhưng lại nổi tiếng là không có khả năng tìm kiếm hiệu quả các bản ghi được lưu trữ và có thể cần sự can thiệp của con người để tìm đúng băng và khôi phục dữ liệu để phân tích. Tuổi thọ của phương tiện cũng cần được xem xét ở đây và tần suất ghi lại phương tiện để đáp ứng yêu cầu về thời gian lưu giữ. Ví dụ, bảy năm đối với đĩa CD hoặc DVD ghi được giá rẻ có lẽ là một khoảng thời gian quá dài. Công nghệ định dạng ngày càng lỗi thời và khả năng mua ổ đĩa để đọc băng và đĩa có thể trở nên khan hiếm.
</div>

##  Nguyên tắc trong quản lý log

### Luật Thu Thập

<div style="text-align: justify; text-indent: 2em;">
Đừng thu thập dữ liệu log mà bạn không có ý định sử dụng
</div>

- Chỉ thu thập log khi có lý do rõ ràng (điều tra sự cố, phân tích bảo mật, v.v.).
- Tránh tâm lý "thu thập cho có" hoặc "biết đâu cần đến".
- Áp dụng cả cho việc tạo log: đừng sinh ra log nếu bạn không dùng đến.

### Luật Lưu Trữ

<div style="text-align: justify; text-indent: 2em;">
Chỉ giữ log lâu như khoảng thời gian bạn nghĩ rằng nó còn có thể hữu ích hoặc lâu hơn nếu luật yêu cầu.
</div>

- Dữ liệu log nên được lưu trữ dựa trên:
- - Giá trị sử dụng tiềm năng.
- - Yêu cầu pháp lý hoặc tuân thủ.
- Không nên lưu mọi log trong 7 năm nếu không cần thiết.

### Luật Giám Sát

<div style="text-align: justify; text-indent: 2em;">
Ghi log càng nhiều càng tốt, nhưng chỉ cảnh báo khi thật sự cần phản ứng.
</div>

- Dữ liệu có thể khổng lồ (petabyte), nhưng năng lực con người có hạn (12 cảnh báo/ngày?).
- Tránh làm "ngập lụt" đội ngũ giám sát với các cảnh báo không cần thiết.
- Triết lý: Log all – Store some – Monitor what matters.

### Luật An Ninh

<div style="text-align: justify; text-indent: 2em;">
Đừng đầu tư bảo vệ log nhiều hơn mức bạn bảo vệ dữ liệu kinh doanh quan trọng.
</div>

- Log có giá trị nhưng không nên bảo vệ hơn cả bí mật kinh doanh hoặc dữ liệu nhạy cảm.
- Biện pháp thực tế:
- - Hash log để chống chỉnh sửa.
- - Áp dụng kiểm soát truy cập hợp lý.
- Tránh mã hóa log trừ khi thật cần thiết (do tốn tài nguyên và phức tạp).

### Luật Thay Đổi Liên Tục

<div style="text-align: justify; text-indent: 2em;">
Nguồn log, loại log và nội dung log luôn thay đổi.
</div>

- Môi trường CNTT thay đổi liên tục (cloud, container, microservice...).
- Cần:
- - Rà soát chính sách và quy trình log định kỳ.
- - Cập nhật hệ thống log collector, parser.
- - Tài liệu hóa quá trình từ sinh log → lưu trữ cuối.