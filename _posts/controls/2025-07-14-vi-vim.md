---
layout: post
title: "Vi and Vim: A Practical Reference"
date: 2025-07-14 10:00:00 +0700
categories: [Controls]
---

Few tools divide developers like vi. It's cryptic at first glance, but once the modal editing model clicks, it becomes one of the fastest ways to work with text in a terminal. This post covers vi from the ground up, then explores the extensions that make Vim a genuinely modern editor.

## Table of Contents

1. [Vi](#vi)
   - [Opening a File](#opening-a-file)
   - [Basic Editing](#basic-editing)
   - [Intermediate Vi](#intermediate-vi)
   - [Advanced Vi](#advanced-vi)
   - [Working with Multiple Files](#working-with-multiple-files)
2. [Vim](#vim-vi-improved)

---

## Vi

Vi copies the file to be edited into a buffer, displays it, and lets you add, delete, and change text. When you save, vi writes the edited buffer back to disk, replacing the original file.

### Opening a File

```
vi filename
```

This opens an existing file, or creates a new one if the filename doesn't exist. You'll notice tildes (`~`) down the left side — these mark empty lines. The filename and file status appear on the bottom status line.

### Modes

Vi operates in two modes:

- **Command mode** — every keystroke is a command; this is where you start when you open a file
- **Insert mode** — keystrokes are entered as text

To enter insert mode, use `i`, `I`, `a`, `A`, or a few other commands (described below). To return to command mode from anywhere, press `ESC`.

### Basic Editing

Once in insert mode, you can move with arrow keys, delete text with the Delete key, and type normally — though note that the mouse is not available in standard vi (Vim adds mouse support as an option). Press `ESC` to return to command mode when done.

#### Saving and Quitting

| Command | Action |
|---------|--------|
| `ZZ` | Save and quit |
| `:wq` or `:x` | Save and quit (ex command) |
| `:q!` | Quit without saving |

Note: vi commands are **case-sensitive**. `ZZ` and `zz` do different things.

---

### Intermediate Vi

#### Simple Edits

| Command | Action |
|---------|--------|
| `i` | Insert before cursor (`I` = at start of line) |
| `a` | Append after cursor (`A` = at end of line) |
| `r` | Replace a single character |
| `~` | Toggle case of character under cursor |
| `dw` | Delete a word |
| `dd` | Delete a line |
| `dl` or `x` | Delete one character |
| `D` | Delete from cursor to end of line |
| `cw` | Change a word |
| `cc` or `S` | Change entire line |
| `C` | Change from cursor to end of line |
| `s` | Substitute character at cursor |
| `.` | Repeat last command |
| `u` | Undo last change |

Most commands accept a **count prefix** to repeat them. For example:
- `2dd` — delete two lines
- `2cb` — change back two words
- `20i hi, there! ESC` — insert "hi, there!" 20 times

#### Navigation

**Scrolling:**

| Command | Action |
|---------|--------|
| `Ctrl-F` | Scroll forward one full screen |
| `Ctrl-D` | Scroll forward half screen |
| `Ctrl-B` | Scroll backward one full screen |
| `Ctrl-U` | Scroll backward half screen |

**Screen position:**

| Command | Action |
|---------|--------|
| `H` | Move to top line on screen |
| `M` | Move to middle line on screen |
| `L` | Move to last line on screen |

**Line and word movement:**

| Command | Action |
|---------|--------|
| `h` `j` `k` `l` | Left, down, up, right |
| `e` | End of current word |
| `b` | Beginning of current/previous word |
| `0` or `^` | Beginning of line |
| `$` | End of line |
| `+` / `-` | First character of next / previous line |
| `#G` | Go to line number `#` |
| `G` | Go to last line of file |
| ` `` ` | Return to previous position |

To show line numbers: `:set nu` or `:set number`. To hide them: `:set nu!` or `:set nonumber`.

#### Searching

Use `/pattern` to search forward for a pattern, then press `ENTER`. Regular expressions are supported.

| Command | Action |
|---------|--------|
| `/pattern` | Search forward |
| `?pattern` | Search backward |
| `n` | Repeat search forward |
| `N` | Repeat search backward |
| `fx` | Find character `x` forward in line |
| `Fx` | Find character `x` backward in line |
| `;` / `,` | Repeat character search forward / backward |

#### Cutting, Copying, and Pasting

Deleted text is automatically saved to an unnamed buffer and can be pasted with `p` (after cursor) or `P` (before cursor). Vi maintains nine numbered delete buffers — `"1p` pastes the last deletion, `"2p` the one before that, and so on.

To **yank (copy)** without deleting, use `y` combined with any movement command:

| Command | Action |
|---------|--------|
| `yw` | Yank a word |
| `y$` | Yank to end of line |
| `y^` | Yank to beginning of line |
| `yy` or `Y` | Yank entire line |

**Named buffers (a–z)** let you store and retrieve specific text across edits:

```
"z5dd    " delete 5 lines into buffer z
"z5yy    " yank 5 lines into buffer z
"zp      " paste from buffer z
```

Using a capital letter appends to an existing named buffer (e.g., `"Zdd` appends to buffer `z`).

#### Joining Lines

`J` joins the current line with the line below it, replacing the newline with a space.

#### Undo

| Command | Action |
|---------|--------|
| `u` | Undo last change |
| `U` | Undo all changes on current line (while cursor stays on it) |

---

### Advanced Vi

#### The Ex Editor

Every time you type a colon in vi, you're invoking a command from `ex` — the line editor that vi is built on top of. While vi works on characters and screens, ex works on lines, making it powerful for bulk operations across a file.

**Addressing lines in ex:**

Lines can be addressed three ways, and they can be combined:

1. **Explicit line numbers** — `:3,18d` deletes lines 3 through 18
2. **Symbolic addresses:**
   - `.` = current line
   - `$` = last line
   - `%` = all lines
   - Example: `:.,$d` deletes from current line to end of file; `:%d` deletes everything
3. **Search patterns** — `/pattern/d` deletes the next line matching `pattern`; `/pattern1/,/pattern2/d` deletes the range between two patterns

#### Global Substitution

The substitute command `:s` is one of the most useful tools in vi.

| Command | Action |
|---------|--------|
| `:s/old/new/` | Replace first occurrence on current line |
| `:s/old/new/g` | Replace all occurrences on current line |
| `:50,100s/old/new/g` | Replace in lines 50–100 |
| `:%s/old/new/g` | Replace in entire file |
| `:%s/old/new/gc` | Replace with confirmation for each match |

To combine with a pattern filter — only replace on lines matching a condition:

```vim
:g/pattern/s/old/new/g
```

**Regular expressions in substitutions:**

| Syntax | Meaning |
|--------|---------|
| `.` `*` `[]` | Standard regex wildcards |
| `\( \)` | Capture group; back-reference with `\1` through `\9` |
| `\<` `\>` | Word boundary (start/end) |
| `[:alnum:]` | POSIX bracket expression (use inside `[]`: `[[:alnum:]]`) |

---

### Working with Multiple Files

#### Reading a File Into the Current Buffer

```vim
:r filename        " inserts file contents below current line
:5r filename       " inserts below line 5
```

#### Editing Multiple Files

Open several files at launch:

```bash
vi file1 file2 file3
vi file*
```

Or load additional files from within vi:

```vim
:w              " save current file first
:e filename     " open new file
:n              " move to next file in list
:args           " show all files being edited (current file in brackets)
```

Press `Ctrl-^` to switch to the previously edited file.

#### Opening in Tabs or Splits

```bash
vi -p file1 file2 file3   # open in tabs
vi -o file1 file2 file3   # open in horizontal splits
vi -O file1 file2 file3   # open in vertical splits
```

#### Search and Replace Across Multiple Files

To run a substitution across all open buffers:

```vim
:bufdo %s/pattern/replace/ge | update
```

The `e` flag suppresses errors if the pattern isn't found in a buffer. `update` saves only buffers that were changed.

Alternative approaches depending on your workflow:

```vim
" Auto-save all changed buffers
:set autowriteall
:bufdo %s/pattern/replace/ge

" Use 'hidden' to defer saving; then :wa to write all at once
:set hidden
:bufdo %s/pattern/replace/ge
:wa

" Review changes without saving
:bufdo! %s/pattern/replace/ge
```

The same pattern works with `:argdo` (argument list), `:tabdo` (all tabs), `:windo` (all windows in current tab), or `:cdo` (quickfix list).

---

## Vim (Vi IMproved)

Vim is a superset of vi — everything above still applies, but Vim adds significant capabilities that make it viable as a primary development environment.

### Syntax Highlighting and Indentation

Vim provides syntax-aware color coding for hundreds of file types, automatically adjusting highlighting based on language context. Indentation rules can also be set per filetype, supporting both space and tab conventions.

```vim
:syntax on
:set filetype=python
:set expandtab shiftwidth=4
```

### Programmer Features

Vim includes many features normally found in full IDEs:

- **Tag navigation** — jump to function/variable definitions with `Ctrl-]`
- **Autocompletion** — `Ctrl-N` / `Ctrl-P` for word completion while typing
- **Quickfix list** — integrate compiler output and jump to errors with `:make` and `:cn`/`:cp`
- **Folding** — collapse and expand blocks of code
- **Diff mode** — `vimdiff file1 file2` for side-by-side comparison

### GUI (gVim)

`gvim` provides a graphical interface with menu bars, mouse support, and system clipboard integration, while keeping all the same Vim keybindings.

### Scripting and Plugins

Vim has its own scripting language (Vimscript), allowing you to automate tasks, define custom commands, and extend the editor's behavior. A large ecosystem of plugins is available — modern plugin managers like [vim-plug](https://github.com/junegunn/vim-plug) or [Vundle](https://github.com/VundleVim/Vundle.vim) make installation straightforward.

### Configuration with `.vimrc`

Vim reads `~/.vimrc` at startup. A minimal useful configuration might look like:

```vim
set number          " show line numbers
set hlsearch        " highlight search matches
set incsearch       " search as you type
set tabstop=4       " tab width
set expandtab       " use spaces instead of tabs
syntax on           " enable syntax highlighting
```

### Session Persistence

Vim stores session state in `~/.viminfo`, including command history, register contents, marks, and search history. This means a yank from one session can be pasted in the next, and your last cursor position is remembered per file.

### Transparent Editing

Vim can open compressed and archived files directly — for example, `vim myfile.tar.gz` will unpack and display the archive contents for navigation and editing. Directories can also be opened, launching Vim's built-in file browser (`netrw`).

### Postprocessing Hooks

Vim's autocommand system (`autocmd`) lets you define actions that run at specific points in the editing lifecycle — before/after reading or writing a file, when entering a buffer, and more. For example:

```vim
" Strip trailing whitespace on save
autocmd BufWritePre * :%s/\s\+$//e
```

### Meta Registers

Vim provides four read-only registers useful for inserting contextual information:

| Register | Content |
|----------|---------|
| `%` | Current filename |
| `#` | Alternate (previously edited) filename |
| `:` | Last ex command executed |
| `.` | Last inserted text |

Access them in insert mode with `Ctrl-R %`, `Ctrl-R :`, etc.

---

*Once the modal model becomes natural, vi's efficiency is hard to give up — and Vim's extensions make it a genuinely capable editor for serious development work.*