---
layout: post
title: "Block Ack"
date: 2024-08-12 10:00:00 +0700
categories: [WiFi]
---

## Message Flow

<div style="text-align: justify; text-indent: 2em;">
Cơ chế Block Ack cải thiện hiệu quả kênh bằng cách tổng hợp nhiều thông báo xác nhận thành một khung duy nhất. Có hai loại cơ chế Block Ack: tức thời và trì hoãn. Block Ack tức thời phù hợp với lưu lượng truy cập băng thông cao, độ trễ thấp, trong khi Block Ack trì hoãn phù hợp với các ứng dụng chấp nhận độ trễ vừa phải.
</div>

<div style="text-align: justify; text-indent: 2em;">
Cơ chế Block Ack được khởi tạo bằng việc trao đổi các khung Yêu cầu/Phản hồi ADDBA. Sau khi khởi tạo, các khối khung dữ liệu QoS có thể được truyền từ bên gửi đến bên nhận. Một khối có thể được bắt đầu trong một TXOP thăm dò hoặc bằng cách thắng tranh chấp EDCA. Các MPDU trong khối khung được xác nhận bằng khung BlockAck, được yêu cầu bởi khung BlockAckReq.
</div>

<div style="text-align: justify; text-indent: 2em;">
Sơ đồ bên dưới thể hiện biểu đồ trình tự thông báo cho quá trình thiết lập, truyền dữ liệu và xác nhận khối (Block Ack), cũng như quá trình hủy bỏ cơ chế xác nhận khối.
</div>

![H1](/assets/img/wifi/flow_message.png)

<div style="text-align: justify; text-indent: 2em;">
Sơ đồ bên dưới minh họa hai loại cơ chế Block Ack.
</div>

![H1](/assets/img/wifi/kind_of_block_ack.png)

## Setup

<div style="text-align: justify; text-indent: 2em;">
Tx STA (bên khởi tạo) trước tiên kiểm tra xem STA nhận dự định có khả năng tham gia vào cơ chế BlockAck hay không bằng cách phát hiện và kiểm tra các bit khả năng Delayed Block Ack và Immediate Block Ack của nó. Nếu STA nhận dự định có khả năng tham gia, bên khởi tạo sẽ gửi khung yêu cầu ADDBA cho biết TID mà Block Ack đang được thiết lập.
</div>

<div style="text-align: justify; text-indent: 2em;">
STA nhận sẽ phản hồi bằng khung phản hồi ADDBA. STA nhận có quyền chấp nhận hoặc từ chối yêu cầu. Khi STA nhận chấp nhận, một thỏa thuận Block Ack sẽ tồn tại giữa bên gửi và bên nhận.
</div>

## Data & BlockAck

<div style="text-align: justify; text-indent: 2em;">
Bên khởi tạo có thể truyền một khối các khung dữ liệu QoS được phân tách bởi chu kỳ SIFS, với tổng số khung không vượt quá giá trị trường con Kích thước bộ đệm trong khung Phản hồi ADDBA liên quan và tuân theo bất kỳ giới hạn thời lượng bổ sung nào dựa trên cơ chế truy cập kênh. Mỗi khung phải có trường con Chính sách xác nhận trong trường Điều khiển QoS được đặt thành Xác nhận khối.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bên khởi tạo yêu cầu xác nhận các khung dữ liệu QoS đang chờ xử lý bằng cách gửi khung Basic BlockAckReq. Bên nhận phải duy trì bản ghi Block Ack cho khối đó.
</div>

## Teardown

<div style="text-align: justify; text-indent: 2em;">
Khi bên khởi tạo không còn dữ liệu để gửi và quá trình trao đổi Block Ack cuối cùng đã hoàn tất, bên khởi tạo sẽ báo hiệu kết thúc việc sử dụng cơ chế Block Ack bằng cách gửi khung DELBA đến bên nhận. Không có khung phản hồi quản lý nào từ bên nhận. Bên nhận khung DELBA sẽ giải phóng tất cả các tài nguyên được phân bổ cho việc truyền Block Ack.
</div>

<div style="text-align: justify; text-indent: 2em;">
Thỏa thuận Block Ack có thể bị hủy bỏ nếu không có khung dữ liệu BlockAck, BlockAckReq hoặc QoS nào (được gửi theo chính sách Block Ack) cho TID của Block Ack nhận được từ phía đối tác trong khoảng thời gian bằng giá trị thời gian chờ Block Ack.
</div>

## References