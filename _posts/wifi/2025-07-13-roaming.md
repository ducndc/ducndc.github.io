---
layout: post
title: "Roaming and Band Steering"
date: 2025-01-12 10:00:00 +0700
categories: [WiFi]
---

## Roaming Overview

<div style="text-align: justify; text-indent: 2em;">
Mặc dù WLAN sử dụng phương tiện không dây để cải thiện khả năng di động của người dùng, nhưng nó cũng mang đến những thách thức mới, chẳng hạn như đảm bảo trải nghiệm người dùng được duy trì tốt.
</div>

<div style="text-align: justify; text-indent: 2em;">
Để đảm bảo trải nghiệm người dùng tốt nhất, chất lượng tín hiệu cao là điều cần thiết, do đó việc giao tiếp giữa các thiết bị đầu cuối (STA) và điểm truy cập (AP) thông qua phương tiện không dây ngày càng trở nên quan trọng. Tuy nhiên, vấn đề là tín hiệu giữa các STA và AP sẽ yếu đi khi khoảng cách truyền dẫn tăng lên. Vì vậy, các nhà cung cấp đã áp dụng công nghệ roaming thông minh để cho phép các STA di chuyển ra xa AP có thể chuyển sang AP gần hơn, đảm bảo chất lượng tín hiệu ổn định. Ngoài ra, việc lập lịch giúp mạng WLAN tránh bị tắc nghẽn.
</div>

## Technological Background

<div style="text-align: justify; text-indent: 2em;">
Chất lượng tín hiệu suy giảm khi các thiết bị đầu cuối (STA) di chuyển ra xa điểm truy cập (AP). Do đó, khi chất lượng tín hiệu giảm xuống mức nhất định (còn gọi là ngưỡng chuyển vùng), các thiết bị đầu cuối sẽ chuyển vùng đến AP gần hơn để duy trì chất lượng tín hiệu.
</div>

![H1](/assets/img/wifi/sys.png)

<div style="text-align: justify; text-indent: 2em;">
1. Trong khi vẫn duy trì kết nối với AP 1, STA gửi các khung yêu cầu thăm dò trên tất cả các kênh được hỗ trợ. Sau đó, sau khi nhận được yêu cầu trên kênh 6 (được AP 2 sử dụng), AP 2 gửi phản hồi trên kênh 6. Sau khi nhận được phản hồi, STA đánh giá chất lượng tín hiệu của AP 1 và AP 2 và xác định AP tối ưu để kết nối. Trong ví dụ được cung cấp, AP 2 được chọn.
</div>

<div style="text-align: justify; text-indent: 2em;">
2. Như minh họa ở mục 1, STA gửi yêu cầu kết nối đến AP 2 trên kênh 6, và AP 2 gửi phản hồi kết nối. Sau đó, một kết nối được thiết lập giữa STA và AP 2.
</div>

<div style="text-align: justify; text-indent: 2em;">
3. Như minh họa trong hình 2, STA gửi yêu cầu tách khỏi AP 1 trên kênh 1 (được AP 1 sử dụng) để tách khỏi AP 1.
</div>

<div style="text-align: justify; text-indent: 2em;">
Nếu chính sách bảo mật STA sử dụng xác thực mở hoặc xác thực khóa chia sẻ tương đương với bảo mật có dây (WEP), thì không cần thực hiện thêm thao tác nào. Tuy nhiên, nếu sử dụng Wi-Fi Protected Access (WPA) hoặc Wi-Fi Protected Access 2 (WPA2) + khóa chia sẻ trước (PSK), thì cần thêm một bước đàm phán khóa. Nếu sử dụng WPA2 + 802.1X, thì cần thêm một bước xác thực 802.IX và đàm phán khóa.
</div>

<div style="text-align: justify; text-indent: 2em;">
Mỗi khi một thiết bị đầu cuối (STA) truy cập vào một điểm truy cập (AP), với WPA/WPA2 + PSK và WPA2+802.1X, quá trình đàm phán khóa hoặc tương tác xác thực là bắt buộc. Điều này dẫn đến thời gian chuyển đổi sang AP mới kéo dài và làm tăng nguy cơ gián đoạn dịch vụ cũng như hiện tượng giật hình và gián đoạn khung hình thoại và video. Phần sau đây mô tả cách sử dụng tính năng chuyển vùng nhanh và chuyển vùng hỗ trợ 802.11k để giải quyết những thách thức này.
</div>

<div style="text-align: justify; text-indent: 2em;">
Ngoài vấn đề xác thực, cần phải xem xét cả tính ổn định của STA. Do ngưỡng chuyển vùng không nhất quán giữa các nhà cung cấp STA, một số thiết bị đầu cuối phản hồi chậm khi chuyển vùng. Như minh họa trong Hình 3.14, khi di chuyển đến gần AP có chất lượng tín hiệu cao hơn, các STA vẫn được liên kết với AP ban đầu, ngay cả khi chất lượng tín hiệu trở nên cực kỳ thấp. Điều này được gọi là tính ổn định, và các thiết bị đầu cuối này được gọi là STA ổn định (sticky STA).
</div>

<div style="text-align: justify; text-indent: 2em;">
Chất lượng tín hiệu yếu khiến trải nghiệm dịch vụ không được đảm bảo cho các thiết bị đầu cuối (STA) cố định. Điều này cũng làm giảm tốc độ truyền dữ liệu cho các STA này, dẫn đến việc tiêu thụ nhiều tài nguyên giao diện không dây hơn bình thường. Kết quả là, các STA khác bị ảnh hưởng tiêu cực. Phần này sẽ trình bày chi tiết hơn về cách sử dụng roaming thông minh để giải quyết vấn đề này.
</div>

![H1](/assets/img/wifi/roamingSys.png)

## Fast Roaming Principles

<div style="text-align: justify; text-indent: 2em;">
Chuyển vùng nhanh giúp đơn giản hóa quá trình trao đổi xác thực STA và/hoặc đàm phán khóa của WPA2 + PSK và WPA2 + 802.1X, rút ngắn thời gian chuyển vùng đến điểm truy cập (AP) mới. Phần này sử dụng Giao thức xác thực mở rộng được bảo vệ bởi Giao thức xác thực mở rộng (EAP-PEAP) và Chuẩn mã hóa nâng cao (AES) làm ví dụ để mô tả các nguyên tắc của chuyển vùng nhanh.
</div>

<div style="text-align: justify; text-indent: 2em;">
Dựa trên cơ chế chuyển vùng thông thường đến một AP mới, toàn bộ quá trình trao đổi gói dữ liệu bao gồm xác thực liên kết, tái liên kết, xác thực STA và trao đổi khóa, như minh họa trong hình bên dưới. Hai thao tác cuối cùng chiếm phần lớn thời gian trao đổi tổng thể.
</div>

![H1](/assets/img/wifi/roamingFlow.png)

### 1. PMK fast roaming

<div style="text-align: justify; text-indent: 2em;">
Để cải thiện trải nghiệm chuyển vùng, 802.lli giới thiệu tính năng lưu trữ bộ nhớ đệm PMK nhằm tránh xác thực 802.IX. Quá trình chuyển vùng với tính năng lưu trữ bộ nhớ đệm PMK được gọi là chuyển vùng nhanh PMK và chỉ áp dụng cho xác thực WPA2 + 802.1X.
</div>

<div style="text-align: justify; text-indent: 2em;">
Trong cơ chế chuyển vùng nhanh PMK, các thiết bị STA bao gồm Mã định danh PMK (PMKID) trong các yêu cầu liên kết/tái liên kết của chúng. Các thiết bị STA xác định PMK của chúng một cách duy nhất và không thể đảo ngược thông qua PMKID. Sau đó, khi nhận được yêu cầu liên kết/tái liên kết, AP hoặc WAC sẽ tạo ra một PMKID dựa trên PMK của chính nó. Nếu kết quả phù hợp với kết quả trong yêu cầu, thiết bị STA được coi là đã hoàn tất xác thực 802.IX và AP hoặc WAC sẽ trực tiếp gửi phản hồi liên kết/tái liên kết. Quá trình trao đổi khóa tiếp tục mà không cần thêm quá trình xác thực STA nào khác.
</div>

<div style="text-align: justify; text-indent: 2em;">
Như đã mô tả ở trên, PMKID là chìa khóa cho việc chuyển vùng nhanh PMK. Khi chuyển vùng thông thường hoặc khi truy cập lần đầu vào các mạng có bật xác thực WPA2+802.1X, PMK được tạo trên cả STA và WAC trong quá trình xác thực STA và được sử dụng để tạo các khóa tạm thời theo cặp (PTK) trong quá trình trao đổi khóa. Một PMK, với địa chỉ MAC của STA, mã định danh tập hợp dịch vụ cơ bản (BSSID) và thời gian tồn tại của PMK, tạo thành một liên kết bảo mật khóa chính theo cặp (PMKSA). PMKID được tạo dựa trên PMKSA bằng công thức:
</div>

<div style="text-align: justify; text-indent: 2em;">
PMKID = HMAC-SHAl-128(PMK,"PMKName"|BSSID|MAC_STA)
</div>

<div style="text-align: justify; text-indent: 2em;">
HMAC-SHA1-128 là một hàm băm. PMKID được tính toán bằng hàm này là duy nhất và không thể đảo ngược. Tên PMK là một chuỗi ký tự cố định.
</div>

<div style="text-align: justify; text-indent: 2em;">
Dựa trên công thức này, PMKID vẫn không thay đổi miễn là địa chỉ PMK và MAC không bị thay đổi. Các STA bao gồm PMKID trong yêu cầu kết nối/tái kết nối của chúng. Sau khi nhận được yêu cầu kết nối/tái kết nối, AP báo cáo PMKID cho WAC. Sau đó, WAC tính toán PMKID và so sánh kết quả với giá trị nhận được. Nếu hai giá trị giống nhau, WAC coi STA đã được xác thực và trực tiếp chỉ thị AP gửi phản hồi thành công kết nối cho STA. Khi PMKID được xác minh thành công, quá trình trao đổi khóa sẽ được tiến hành trực tiếp mà không cần xác thực lần thứ hai.
</div>

### 2. 802.11r fast roaming

<div style="text-align: justify; text-indent: 2em;">
Chuẩn 802.11r, còn được gọi là Chuyển đổi Bộ Dịch vụ Cơ bản Nhanh (Fast Basic Service Set Transition - FT), đã được thông qua vào ngày 15 tháng 7 năm 2008. Các thiết bị tuân thủ tiêu chuẩn này hỗ trợ chuyển vùng nhanh và an toàn. Chế độ chuyển vùng được gọi là chuyển vùng nhanh 802.11r và áp dụng cho cả xác thực WPA2 + PSK và WPA2 + 802.1X.
</div>

<div style="text-align: justify; text-indent: 2em;">
Trong chế độ chuyển vùng nhanh 802.11r, quá trình xác thực STA và trao đổi khóa được hoàn tất trong quá trình xác thực và liên kết. Nhờ đó, việc xác thực và trao đổi khóa không cần thiết trong quá trình chuyển vùng.
</div>

<div style="text-align: justify; text-indent: 2em;">
Chuẩn 802.llr bao gồm giao thức FT và giao thức yêu cầu tài nguyên FT, trong đó giao thức sau bao gồm thêm một quy trình trao đổi gói xác nhận tài nguyên ngoài giao thức trước. Với quy trình yêu cầu tài nguyên FT, nếu AP đích không có tài nguyên nào khả dụng cho STA, quyền truy cập chuyển vùng của nó sẽ bị từ chối. Mỗi giao thức hỗ trợ hai chế độ: truyền qua không dây (over-the-air) và truyền qua DS (over-the-DS). Ở chế độ truyền qua không dây, việc trao đổi gói chỉ được thực hiện giữa các STA và AP đích. Ngược lại, ở chế độ truyền qua DS, AP nguồn cũng tham gia vào việc trao đổi gói.
</div>

<div style="text-align: justify; text-indent: 2em;">
Hệ thống khóa ba cấp chịu trách nhiệm cho việc đàm phán khóa trong quá trình kết nối, trong đó thiết bị xác thực (AP và WAC) và ứng dụng xác thực có cơ chế riêng của chúng.
</div>

![H1](/assets/img/wifi/PMK.png)

#### PMK-RO

<div style="text-align: justify; text-indent: 2em;">
Là khóa cấp độ đầu tiên được tạo dựa trên PSK hoặc 802.IX PMK, PMK-RO được xác định bằng Tên PMK-RO và được lưu trong Bộ giữ khóa PMK-RO, được gọi là ROKH và SOKH ở phía thiết bị xác thực và ứng dụng xác thực tương ứng. ROKH-ID và SOKH-ID được sử dụng để xác định ROKH và SOKH tương ứng.
</div>

#### PMK-R1

<div style="text-align: justify; text-indent: 2em;">
PMK-R1 là khóa cấp hai được tạo dựa trên PMK-RO. Nó được xác định bằng Tên PMK-R1 và được lưu trong Bộ giữ khóa PMK-R1, được gọi là R1KH và SIKH ở phía thiết bị xác thực và ứng dụng xác thực tương ứng. R1KH-ID và S1KH-ID được sử dụng để xác định R1KH và SIKH tương ứng. Có thể tồn tại nhiều PMK-R1, và bộ tạo PMK-R1 sẽ phân phối PMK-R1 cho mỗi bộ giữ khóa. Trên thực tế, WAC tạo ra một PMK-RO cũng như nhiều PMK-R1 và gửi các PMK-R1 đến các AP khác nhau. Mỗi ứng dụng xác thực bao gồm một PMK-RO, một PMK-R1 và một PTK.
</div>

![H1](/assets/img/wifi/PMK1.png)

#### PTK

<div style="text-align: justify; text-indent: 2em;">
PTK là khóa cấp ba được tạo dựa trên PMK-R1. Sau khi PTK được tạo ở cả hai đầu, việc truyền thông mã hóa có thể được thực hiện. Như minh họa trong ví dụ bên dưới, một STA di chuyển từ AP 1 đến AP 2, trong khi xác thực WPA2 + 802.1X được sử dụng ở phía mạng.</div>

### STA initial access to an FT network

<div style="text-align: justify; text-indent: 2em;">
WAC thông báo cho các STA về việc hỗ trợ chuẩn 802.1 lr bằng cách gửi các khung phản hồi Beacon và probe, đồng thời phát sóng mã định danh miền di động (MDID) của chính nó. Nếu một STA hỗ trợ 802.1 lr, nó sẽ trả lời các khung phản hồi Beacon và probe và bắt đầu quá trình truy cập. Trước tiên, một quy trình xác thực liên kết chung được hoàn tất.
</div>

<div style="text-align: justify; text-indent: 2em;">
Tiếp theo, STA gửi AP 1 một khung yêu cầu liên kết chứa MDID. Sau khi nhận được khung yêu cầu liên kết, AP 1 kiểm tra MDID so với MDID của chính nó và trả lời STA bằng một khung phản hồi liên kết. Tùy thuộc vào kết quả kiểm tra, nếu chúng trùng khớp, AP 1 sẽ gửi khung yêu cầu liên kết đến WAC, và WAC sẽ trả lời bằng một khung phản hồi liên kết chứa MDID, ROKH-ID và R1KH-ID thông qua AP 1. Nếu chúng không trùng khớp, AP 1 sẽ gửi khung phản hồi liên kết cho biết rằng liên kết bị từ chối.
</div>

![H1](/assets/img/wifi/fastRoaming.png)

<div style="text-align: justify; text-indent: 2em;">
ROKH-ID và R1KH-ID lần lượt là địa chỉ MAC của WAC và BSSID của AP 1, và chúng được STA sử dụng để tạo PMK-RO và PMK-R1. Tiếp theo, quá trình xác thực EAP-PEAP được hoàn tất giữa STA và máy chủ RADIUS, sau đó PMK được tạo ra. WAC tạo ra PMK-RO và PMK-R1 tương ứng với AP 1, và gửi PMK-R1 đến AP 1. PMK-R1 được tính toán như sau:
</div>

<div style="text-align: justify; text-indent: 2em;">
KDF-256 là hàm tính toán khóa, R1KH-ID là BSSID, và S1KH-ID là địa chỉ MAC của STA. Cuối cùng, bốn bước bắt tay được hoàn tất giữa STA và WAC, sau đó PTK được tạo ra để mã hóa dữ liệu.
</div>

### STA roaming

<div style="text-align: justify; text-indent: 2em;">
Phần sau mô tả cách một STA đã thiết lập kết nối với AP 1 trong mạng FT chuyển vùng sang AP 2. Đầu tiên, STA gửi cho AP 2 một khung yêu cầu xác thực chứa MDID, Tên PMK-RO, SNonce và ROKH-ID của nó. Tiếp theo, sau khi nhận được khung yêu cầu xác thực, AP 2 kiểm tra xem MDID có giống với MDID của chính nó hay không. Nếu giống nhau, AP 2 trích xuất thông tin từ khung và kết hợp thông tin đã trích xuất với ANonce, R1KH-ID và địa chỉ MAC của STA trước khi gửi đến WAC. Sau đó, sau khi nhận được thông tin, WAC kiểm tra xem Tên PMK-RO có giống với tên của chính nó hay không. Nếu đúng như vậy, WAC sẽ tạo PMK-R1 và PTK dựa trên thông tin còn lại và gửi PMK-R1 và PTK đến AP 2. Sau khi nhận được PMK-R1 và PTK từ WAC, AP 2 coi STA đã xác thực thành công và gửi cho STA một khung phản hồi xác thực chứa R1KH-ID, ANonce, MDID, PMK-RO Name, SNonce và ROKH-ID. Cuối cùng, sau khi nhận được khung phản hồi xác thực, STA sẽ tạo PMK-R1 và PTK dựa trên thông tin có trong đó. Sau đó, STA hoàn tất quá trình xác thực để chuyển vùng nhanh.
</div>

![H1](/assets/img/wifi/roamingFlow.png)

<div style="text-align: justify; text-indent: 2em;">
STA kết nối lại với AP 2 thông qua quy trình sau:
</div>

<div style="text-align: justify; text-indent: 2em;">
Đầu tiên, STA gửi khung yêu cầu tái kết nối chứa thông báo kiểm tra tính toàn vẹn (MIC). Sau đó, sau khi nhận được khung yêu cầu, AP 2 sử dụng PTK được tạo ra để xác minh MIC, và nếu chính xác, sẽ trả về khung phản hồi tái kết nối chứa MIC cho STA. Sau khi nhận được khung phản hồi, STA sử dụng PTK được tạo ra để xác minh MIC, và nếu chính xác, sẽ coi rằng quá trình trao đổi tái kết nối đã hoàn tất và sau đó ngắt kết nối với AP 1.
</div>

![H1](/assets/img/wifi/STARoaming.png)

### Principles of 802.11k Assisted Roaming

<div style="text-align: justify; text-indent: 2em;">
Chuẩn 802.11k định nghĩa cơ chế đo lường tài nguyên vô tuyến WLAN, cho phép các thiết bị đầu cuối (STA) và điểm truy cập (AP) cảm nhận môi trường vô tuyến. Phần sau đây sử dụng các sản phẩm WLAN của Huawei để mô tả cách 802.11k hỗ trợ chuyển vùng cho STA (chuẩn 802.11k sẽ không được mô tả chi tiết). Theo chuẩn 802.11k, các STA gửi yêu cầu đến các AP để lấy danh sách các AP lân cận trong tập dịch vụ mở rộng (ESS). Danh sách này chứa các BSSID và số kênh, như minh họa trong hình bên dưới.
</div>

![H1](/assets/img/wifi/message.png)

![H1](/assets/img/wifi/11k.png)

## Smart Roaming

<div style="text-align: justify; text-indent: 2em;">
Mặc dù các STA cố định chỉ chiếm một phần nhỏ trong tổng số STA, nhưng chúng lại tiềm ẩn rủi ro rất lớn đối với mạng lưới.
</div>

### Decreased throughput

<div style="text-align: justify; text-indent: 2em;">
Các thiết bị STA chuyển vùng đến các AP để có vùng phủ sóng tín hiệu chất lượng cao hơn, cho phép tốc độ truyền dữ liệu cao hơn. Tuy nhiên, tính ổn định của STA hạn chế việc chuyển vùng, buộc các STA phải trao đổi dữ liệu ở tốc độ thấp. Do đó, chúng cần thời gian dài hơn để chiếm dụng tài nguyên giao diện không dây, ngăn cản các STA khác (đặc biệt là các STA tốc độ cao) đạt được thông lượng cao hơn, đồng thời làm giảm thông lượng của AP.
</div>

![H1](/assets/img/wifi/roamingSys1.png)

### Impacted user experience

<div style="text-align: justify; text-indent: 2em;">
Các thiết bị STA cố định không tự động chuyển sang các AP khác cung cấp chất lượng tín hiệu tốt hơn. Kết quả là, vùng phủ sóng bị suy giảm, làm giảm tốc độ truyền dữ liệu và ảnh hưởng đến trải nghiệm người dùng.
</div>

### Disrupted channel planning

<div style="text-align: justify; text-indent: 2em;">
Trong các mạng có nhiều AP, việc lập kế hoạch kênh được thực hiện để tối đa hóa dung lượng mạng bằng cách giảm nhiễu thông qua ghép kênh. Tuy nhiên, sự bám dính của STA hạn chế việc lập kế hoạch kênh vì nó dẫn đến việc sử dụng một kênh nằm ngoài khu vực, có thể gây nhiễu với kênh bên ngoài. Kết quả là, dung lượng giảm, ảnh hưởng đến trải nghiệm người dùng.
</div>

### Smart Roaming Principles

<div style="text-align: justify; text-indent: 2em;">
Tính năng chuyển vùng thông minh được sử dụng để xác định và hướng dẫn các thiết bị STA cố định đến các AP phù hợp hơn, loại bỏ các tác động tiêu cực. Quy trình chuyển vùng thông minh diễn ra như sau:
</div>

<div style="text-align: justify; text-indent: 2em;">
Bước 1: Xác định các STA khó loại bỏ
</div>

<div style="text-align: justify; text-indent: 2em;">
Dựa trên quy hoạch mạng, mỗi AP có một vùng phủ sóng lõi, với các vùng phủ sóng biên được xác định theo cường độ tín hiệu biên cần thiết cho thông lượng biên. Trong ví dụ minh họa ở Hình 3.24, cường độ tín hiệu biên là -65 dBm, và mỗi vùng dịch vụ được phủ sóng bởi ít nhất một AP (các vùng phủ sóng chồng chéo khi nhiều AP cung cấp vùng phủ sóng). Tuy nhiên, nếu tín hiệu mà AP nhận được từ STA yếu hơn so với cường độ tín hiệu biên của AP, thì STA đã đi vào vùng phủ sóng của một AP khác, và quá trình chuyển vùng STA sẽ được kích hoạt. Do đó, khả năng duy trì kết nối của STA có thể được xác định dựa trên cường độ tín hiệu nhận được trên các AP mà STA đang kết nối.
</div>

![H1](/assets/img/wifi/Cover.png)

<div style="text-align: justify; text-indent: 2em;">
Bước 2: Thu thập thông tin về các AP lân cận
</div>

<div style="text-align: justify; text-indent: 2em;">
Để giúp một STA cố định lựa chọn một AP phù hợp hơn, mạng sẽ thu thập thông tin về các AP lân cận thông qua quá trình đo lường. Chuẩn 802.11k cung cấp cơ chế đo lường các AP lân cận và thu thập thông tin liên quan. Đối với các STA hỗ trợ 802.11k, quá trình đo lường được hoàn tất bằng cơ chế này. Đối với các STA không hỗ trợ 802.11k, các AP sẽ thực hiện quét và lắng nghe chủ động để thực hiện quá trình đo lường.
</div>

<div style="text-align: justify; text-indent: 2em;">
Đối với một STA có trạng thái "dính" được xác định hỗ trợ 802.11k, khi phát hiện hành vi "dính", AP liên kết sẽ hướng dẫn STA thực hiện đo lường lân cận dựa trên 802.11k, trong khi STA gửi cho AP cường độ tín hiệu đo được của các AP lân cận dựa trên cơ chế thông báo 802.11k, như minh họa trong Hình 3.25.
</div>

![H1](/assets/img/wifi/notify.png)

<div style="text-align: justify; text-indent: 2em;">
Đối với một STA cố định đã được xác định không hỗ trợ 802.11k, mạng sẽ sử dụng dữ liệu thu được từ quá trình quét AP. Dữ liệu này thường là bản tóm tắt kết quả quét của tất cả các AP trong một khoảng thời gian. Tuy nhiên, vì quá trình quét AP được hoàn thành vào các thời điểm khác nhau, thông tin này thường sẽ gây hiểu nhầm đối với các STA di chuyển nhanh, như minh họa trong Hình 3.26.
</div>

<div style="text-align: justify; text-indent: 2em;">
Để giải quyết thách thức trong việc lựa chọn AP đích phù hợp nhất cho roaming STA, một cơ chế hợp tác giữa các AP đã được giới thiệu để giúp các AP thông báo cho nhau về tải và cường độ tín hiệu. Tuy nhiên, sự phối hợp này dựa trên việc chuyển đổi kênh và quét AP. Trên các AP xử lý thoại, video hoặc các dịch vụ nhạy cảm với độ trễ khác, quá trình quét không được thực hiện để đảm bảo trải nghiệm dịch vụ.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bước 3: Chọn AP phù hợp cho STA dính
</div>

<div style="text-align: justify; text-indent: 2em;">
Dựa trên quá trình quét 802.11k (đối với các STA hỗ trợ) hoặc thông tin thu thập được thông qua sự hợp tác giữa các AP (đối với các STA không hỗ trợ), mạng sẽ tạo ra danh sách AP lân cận cho các STA cố định và chọn một AP đích từ danh sách đó để mỗi STA chuyển vùng đến. AP đích phải đáp ứng các yêu cầu sau:
</div>

![H1](/assets/img/wifi/infor.png)

<div style="text-align: justify; text-indent: 2em;">
Mạng sẽ chọn AP cung cấp tín hiệu mạnh nhất đồng thời đáp ứng các yêu cầu của AP đích.
</div>

![H1](/assets/img/wifi/select.png)

<div style="text-align: justify; text-indent: 2em;">
AP sẽ gửi yêu cầu BTM đến STA kèm theo danh sách BSS ứng cử viên. Khi STA nhận được tin nhắn này, nó sẽ gửi phản hồi BTM trở lại AP.
</div>
![H1](/assets/img/wifi/btm.png)

## Band Steering

<div style="text-align: justify; text-indent: 2em;">
Hiện tại, các nguồn tài nguyên phổ tần được chỉ định cho công nghệ WLAN bao gồm:
</div>

![H1](/assets/img/wifi/2G.png)

<div style="text-align: justify; text-indent: 2em;">
UNII-1 80 MHz, UNII-2 80 MHz, UNII-2 Mở rộng 220 MHz, UNII-3 80 MHz và ISM 20 MHz, như minh họa trong Hình 3.30. Dải tần này cung cấp phổ tần rộng hơn nhiều so với 2.4 GHz, đồng thời cũng có sự khác biệt đáng kể giữa các quốc gia. Ví dụ, Trung Quốc không mở phần UNII-2 Mở rộng, trong khi Hàn Quốc chỉ mở phần UNII-3.
</div>

<div style="text-align: justify; text-indent: 2em;">
Ngoài sự khác biệt đáng kể về lượng tài nguyên phổ tần, băng tần 2.4 và 5 GHz còn khác biệt rất lớn về nhiễu sóng và khả năng hỗ trợ tiêu chuẩn.
</div>

<div style="text-align: justify; text-indent: 2em;">
1. Do băng tần 5GHz có phổ tần dồi dào, chuẩn 802.11ac hỗ trợ việc gộp nhiều kênh 20 MHz thành các kênh 80 MHz hoặc thậm chí 160 MHz. Các kênh có băng thông cao hơn có thể chứa lượng dữ liệu lớn hơn so với các kênh có băng thông thấp. Đối với các trạm đầu cuối (STA), tốc độ truyền dữ liệu cao hơn sẽ giúp rút ngắn thời gian tải xuống tập tin và video.
</div>

<div style="text-align: justify; text-indent: 2em;">
2. Băng tần 2.4 GHz là dải tần đầu tiên được chỉ định cho mạng Wi-Fi và có rất ít sự khác biệt giữa các quốc gia. Nhiều thiết bị thông dụng, chẳng hạn như Bluetooth, lò vi sóng và các thiết bị giám sát và điều khiển từ xa, đều hoạt động trên băng tần này. Do đó, băng tần này có tài nguyên hạn chế nhưng lại được sử dụng nhiều nhất, dẫn đến tình trạng tắc nghẽn.
</div>

![H1](/assets/img/wifi/25G.png)

![H1](/assets/img/wifi/2vs5G.png)

<div style="text-align: justify; text-indent: 2em;">
Hình trên minh họa sự khác biệt giữa hai băng tần 2.4 và 5 GHz bằng phép so sánh tương tự. Băng tần 2.4 GHz giống như một con đường làng hẹp, đầy chướng ngại vật làm chậm tốc độ di chuyển của phương tiện. Ngược lại, băng tần 5 GHz giống như một đường cao tốc rộng mở, cho phép tốc độ cao. Đối với các thiết bị đầu cuối băng tần kép (hỗ trợ cả hai băng tần 2.4 và 5 GHz), băng tần 5 GHz chắc chắn là lựa chọn tối ưu cho dịch vụ Wi-Fi trong hầu hết các trường hợp.
</div>

<div style="text-align: justify; text-indent: 2em;">
Hiện nay, không phải tất cả các thiết bị STA băng tần kép đều chọn băng tần 5 GHz tối ưu. Các thiết bị lỗi thời chỉ chọn mạng dựa trên cường độ tín hiệu và không chủ động giữ kết nối trên băng tần 5 GHz. Mặc dù chức năng ưu tiên 5 GHz đã được một số nhà sản xuất thiết bị đầu cuối triển khai trên điện thoại thông minh, nhưng trong một số trường hợp, thiết bị của họ vẫn truy cập băng tần 2.4 GHz.
</div>

### Band Steering Principles

<div style="text-align: justify; text-indent: 2em;">
Điều khiển băng tần bao gồm nhận dạng STA băng tần kép và điều khiển băng tần 5 GHz tiếp theo.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bước 1: Nhận dạng STA băng tần kép
</div>

<div style="text-align: justify; text-indent: 2em;">
Để phát hiện mạng, các thiết bị STA gửi khung yêu cầu thăm dò đến các AP và nhận khung phản hồi thăm dò từ các AP. Các thiết bị STA băng tần kép gửi khung yêu cầu thăm dò trên tất cả các kênh trong băng tần 2.4 và 5 GHz. Như minh họa trong Hình 3.32, nếu một AP nhận được khung yêu cầu thăm dò ở cả băng tần 2.4 và 5 GHz, thì STA đó là thiết bị đầu cuối băng tần kép.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bước 2: Điều chỉnh băng tần 5 GHz
</div>

<div style="text-align: justify; text-indent: 2em;">
Việc điều chỉnh băng tần được thực hiện cả trong và sau giai đoạn liên kết.
</div>

<div style="text-align: justify; text-indent: 2em;">
1. Điều hướng trong quá trình kết nối: Như đã đề cập ở trên, các thiết bị STA phát hiện mạng bằng cách gửi khung yêu cầu thăm dò, được gọi là quét chủ động. Như minh họa trong Hình 3.33, các AP tạm thời không gửi khung phản hồi thăm dò cho các thiết bị STA trong băng tần 2.4 GHz, điều hướng các thiết bị STA sang băng tần 5 GHz.
</div>

![H1](/assets/img/wifi/proReq.png)

![H1](/assets/img/wifi/proReq1.png)

<div style="text-align: justify; text-indent: 2em;">
2. Điều hướng sau khi kết nối: Ngoài việc quét chủ động, các thiết bị STA sử dụng phương pháp thụ động bao gồm việc lắng nghe các khung Beacon do các AP gửi để phát hiện mạng. Đối với các thiết bị STA vẫn truy cập băng tần 2.4 GHz khi không nhận được khung phản hồi thăm dò trong quá trình quét chủ động, các AP sẽ điều hướng chúng đến băng tần 5 GHz dựa trên chuẩn 802.1 lv.
</div>

![H1](/assets/img/wifi/roaming.png)

## 802.11v - BSS Transition Management

<div style="text-align: justify; text-indent: 2em;">
Quản lý mạng không dây (WNM) cho phép các thiết bị trạm (STA) trao đổi thông tin nhằm cải thiện hiệu suất tổng thể của mạng không dây. Các STA sử dụng giao thức WNM để trao đổi dữ liệu hoạt động, bao gồm cả các điều kiện mạng của chúng.
</div>

<div style="text-align: justify; text-indent: 2em;">
Quản lý chuyển đổi BTM có ba thông điệp, bao gồm truy vấn BTM, yêu cầu BTM và phản hồi BTM.
</div>

<div style="text-align: justify; text-indent: 2em;">
Thông điệp truy vấn BTM được truyền bởi một STA yêu cầu hoặc cung cấp thông tin về AP ứng cử viên chuyển đổi BSS.
</div>

<div style="text-align: justify; text-indent: 2em;">
Thông điệp yêu cầu BTM được AP truyền đi để đáp lại khung truy vấn BTM.
</div>

<div style="text-align: justify; text-indent: 2em;">
Thông điệp phản hồi BTM được một STA truyền đi để đáp lại khung yêu cầu BTM. Trong thông điệp này, có mã trạng thái của STA.</div>

| Status Code | Meaning |
|-------------|--------|
| 0           | Accept |
| 1           | Reject – Unspecified reject reason |
| 2           | Reject – Insufficient Beacon or Probe Response frames from all candidates |
| 3           | Reject – Insufficient available capacity from all candidates |
| 4           | Reject – BSS Termination undesired |
| 5           | Reject – BSS Termination delay requested |
| 6           | Reject – STA BSS Transition Candidate List provided |
| 7           | Reject – No suitable BSS transition candidates |
| 8           | Reject – Leaving ESS |
| 9–255       | Reserved |

## References

[1] https://ebrary.net/195002/computer_science/roaming_scheduling#260750

