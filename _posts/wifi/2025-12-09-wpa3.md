---
layout: post
title: "WPA3"
date: 2025-12-09 10:00:00 +0700
categories: [WiFi]
---

## WPA3 là gì?

<div style="text-align: justify; text-indent: 2em;">
Wi-Fi Protected Access 3 (WPA3) là giao thức mã hóa Wi-Fi thế hệ tiếp theo được Liên minh Wi-Fi (Wi-Fi Alliance) phát hành năm 2018. Nó giới thiệu nhiều chức năng mới dựa trên WPA2, cung cấp khả năng bảo vệ mã hóa mạnh mẽ hơn cho dữ liệu được truyền giữa người dùng và mạng Wi-Fi. Dựa trên các kịch bản ứng dụng và yêu cầu bảo mật của mạng Wi-Fi, các chế độ WPA3 sau đây có sẵn: WPA3-Personal, WPA3-Enterprise và Mã hóa không dây cơ hội (OWE).
</div>

## WPA3-Personal: Bảo vệ mật khẩu nâng cao

WPA3-Personal có thể hoạt động ở hai chế độ:

1. WPA3: Chế độ WPA3 sử dụng bảo vệ SAE và triển khai việc sử dụng Khung quản lý được bảo vệ (PMF). Chế độ này yêu cầu các thiết bị khách không dây phải hỗ trợ WPA3 bắt buộc.
2. Chế độ chuyển tiếp WPA3: Chế độ chuyển tiếp WPA3 có thể xử lý khả năng sử dụng SAE và PMF, đồng thời cho phép các máy khách WPA2 cùng tồn tại trên cùng một SSID nếu các máy khách đó không hỗ trợ WPA3-SAE.

<div style="text-align: justify; text-indent: 2em;">
WPA3-Personal sử dụng xác thực đồng thời giữa các bên ngang hàng (SAE) để thay thế xác thực PSK trong WPA2-Personal.
</div>

<div style="text-align: justify; text-indent: 2em;">
Trong WPA2, xác thực PSK bao gồm quá trình bắt tay 4 bước để đàm phán khóa. Trước khi đàm phán, một PMK được tạo ra dựa trên mã định danh tập hợp dịch vụ (SSID) và PSK, cả hai đều cố định. Do đó, PMK được tạo ra là cố định và có thể được tính toán. Kết quả là, cùng một khóa được sử dụng cho mỗi lần cài đặt lại. Giao thức SAE được WPA3 sử dụng bổ sung thêm bước bắt tay SAE trước quá trình bắt tay 4 bước PSK ban đầu và đưa vào một biến ngẫu nhiên động trong quá trình tạo PMK. Do đó, PMK được đàm phán mỗi lần là khác nhau, đảm bảo tính ngẫu nhiên của khóa. Như vậy, SAE cung cấp một cơ chế xác thực khóa an toàn hơn cho WPA3 để giải quyết các rủi ro bảo mật mà WPA2 bộc lộ.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bảo vệ chống lại các cuộc tấn công KRACK: SAE coi các thiết bị là các thiết bị ngang hàng. Bất kỳ bên nào cũng có thể bắt đầu quá trình bắt tay và gửi thông tin xác thực một cách độc lập. Nếu không có quá trình trao đổi thông điệp, sẽ không còn cơ hội nào cho các cuộc tấn công KRACK.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bảo vệ chống lại các cuộc tấn công bẻ khóa bằng từ điển ngoại tuyến và tấn công vét cạn: SAE trực tiếp từ chối các dịch vụ dành cho các STA cố gắng kết nối với thiết bị nhiều lần, ngăn chặn tấn công vét cạn hoặc bẻ khóa mật khẩu. Ngoài ra, SAE cung cấp chức năng bảo mật chuyển tiếp. Ngay cả khi kẻ tấn công có được mật khẩu bằng một cách nào đó, khóa sẽ được tạo ngẫu nhiên mỗi khi thiết lập kết nối. Do đó, kẻ tấn công không thể giải mã lưu lượng dữ liệu thu được vì khóa đã bị thay đổi khi kẻ tấn công cố gắng thiết lập lại kết nối.
</div>

<div style="text-align: justify; text-indent: 2em;">
SAE cho phép các cá nhân hoặc người dùng gia đình đặt mật khẩu Wi-Fi dễ nhớ hơn mà vẫn đảm bảo mức độ bảo mật tương đương ngay cả khi mật khẩu không đủ phức tạp.
</div>

### Chế độ WPA3 SAE

<div style="text-align: justify; text-indent: 2em;">
So với WPA2, WPA3-SAE sử dụng thêm hai khung xác thực, tiếp theo là yêu cầu/phản hồi liên kết và sau đó là quá trình bắt tay 4 bước để tạo ra các khóa mã hóa như hình bên dưới.
</div>

![H1](assets/img/wifi/rtaImage.avif)

<div style="text-align: justify; text-indent: 2em;">
Cả bốn khung xác thực (hai khung cam kết và hai khung xác nhận) cho WPA-3 SAE đều chứa thông tin quan trọng để tính toán PMK dựa trên mật mã đường cong Elliptic (ECC). Chúng ta hãy cùng phân tích chúng bên dưới.
</div>

### Authentication (SAE Commit)

<div style="text-align: justify; text-indent: 2em;">
 STA và AP tạo ra hai số ngẫu nhiên là Số vô hướng và Phần tử trường hữu hạn, đồng thời chứa cả mật khẩu băm từ một thuật toán đã biết sử dụng đường cong Elliptic Diffie-Hellman. Cả hai bên gửi Số vô hướng và Phần tử trường hữu hạn của mình cho bên kia bằng cách sử dụng Cam kết xác thực như hình bên dưới.
</div>

![H1](assets/img/wifi/rtaImage1.avif)

![H1](assets/img/wifi/rtaImage2.avif)

<div style="text-align: justify; text-indent: 2em;">
Cùng với đại lượng vô hướng và phần tử trường hữu hạn, các khung xác thực từ cả STA và AP cũng chứa các tham số chung khác như:
</div>

- Thuật toán xác thực: Xác thực đồng thời của các bên ngang hàng (SAE) (3) - Số thuật toán xác thực là 3 được sử dụng cho SAE, các số thuật toán khác là (0 = Hệ thống mở, 1 = Khóa chia sẻ, 2 = Chuyển đổi BSS nhanh)
- Trình tự xác thực: 0x0001 - Số trình tự xác thực 1 được sử dụng cho khung cam kết SAE và số trình tự xác thực 2 được sử dụng cho khung xác nhận SAE
- Mã trạng thái: Thành công (0x0000) - Hiển thị mã trạng thái Thành công
- ID nhóm: Nhóm ECP ngẫu nhiên 256 bit (19) - SAE sử dụng trao đổi khóa Diffie-Hellman (DH) kết hợp với nhóm môđun nguyên tố hoặc nhóm đường cong Elliptic để thiết lập kết nối an toàn trên môi trường không an toàn. Tuy nhiên, WPA-3 Personal bắt buộc phải sử dụng trao đổi khóa Diffie-Hellman kết hợp với nhóm đường cong Elliptic (ECDH). Hiện đã có một số đường cong được định nghĩa trước dưới dạng các nhóm DH 19, 20 và 21. Ví dụ, DH19 đề cập đến đường cong elip 256 bit, được chọn làm nhóm ECDH tối thiểu để đảm bảo khả năng tương tác trong SAE. DH20 đề cập đến đường cong elip 384 bit, trong khi DH 21 đề cập đến đường cong elip 521 bit, và các số nhóm Diffie-Hellman cao hơn thường an toàn hơn.

<div style="text-align: justify; text-indent: 2em;">
Cam kết xác thực từ STA có thêm một tham số tên là Mã thông báo chống tắc nghẽn, được sử dụng để cung cấp một số biện pháp phòng vệ chống lại các cuộc tấn công tràn ngập bằng địa chỉ MAC giả mạo. Mã thông báo này được liên kết với địa chỉ MAC của người gửi khung Cam kết SAE và người gửi phải phản hồi bằng mã thông báo này trong các khung Cam kết tiếp theo. Kẻ tấn công sử dụng địa chỉ MAC giả mạo sẽ không thể thực hiện điều này hoặc ít nhất sẽ có tốc độ tấn công tràn ngập chậm hơn do việc tính toán mã thông báo.
</div>

### Authentication (SAE Confirm)

<div style="text-align: justify; text-indent: 2em;">
Cả STA và AP không dây, sau khi nhận được Scalar và Finite Field Element từ nhau, sẽ tính toán một giá trị băm và chia sẻ chúng trong các khung xác nhận xác thực như hình ảnh bên dưới.
</div>

![H1](assets/img/wifi/rtaImage3.avif)

![H1](assets/img/wifi/rtaImage4.avif)

<div style="text-align: justify; text-indent: 2em;">
Từ các khung Xác nhận xác thực ở trên, lưu ý rằng mã băm từ STA không bằng mã băm từ AP, nhưng cả hai bên đều có thể xác minh mã băm của bên kia bằng cách tự tính toán mã băm và so sánh với mã băm mà họ nhận được. Trong trường hợp mã băm được xác nhận, PMK sẽ được tính toán.
</div>

<div style="text-align: justify; text-indent: 2em;">
Điều quan trọng cần biết là PMK này không dựa trên chính mật khẩu mà dựa trên các đại lượng vô hướng và các phần tử trường hữu hạn được tính toán bằng các số ngẫu nhiên, chỉ sử dụng phiên bản băm của mật khẩu. Mỗi khi các số ngẫu nhiên này thay đổi, các đại lượng vô hướng và các phần tử trường hữu hạn cũng thay đổi, từ đó PMK cũng thay đổi.
</div>

<div style="text-align: justify; text-indent: 2em;">
Do đó, với các khung Xác nhận Xác thực và Cam kết thành công, STA và Client sẽ lấy được PMK và Wireless STA sẽ gửi khung Yêu cầu Liên kết với AKM 00-0F-AC:8, được sử dụng để chỉ ra rằng SAE đang được sử dụng. Lưu ý rằng tùy chọn Bảo vệ Khung Quản lý được yêu cầu và Có khả năng được đặt thành True trong Khả năng RSN của Yêu cầu Liên kết.
</div>

![H1](assets/img/wifi/rtaImage5.avif)

<div style="text-align: justify; text-indent: 2em;">
Sau đó, AP chấp nhận yêu cầu liên kết và gán một ID liên kết, mã trạng thái hiển thị là thành công như trong khung phản hồi liên kết bên dưới.
</div>

![H1](assets/img/wifi/rtaImage.webp)

<div style="text-align: justify; text-indent: 2em;">
Như vậy, với PMK đã được thiết lập, AP và STA sẽ thực hiện quy trình bắt tay 4 bước để lấy các khóa mã hóa (PTK, GTK) và cho phép truyền dữ liệu an toàn giữa AP và máy khách.
</div>

### WPA3 Transition Mode

<div style="text-align: justify; text-indent: 2em;">
Chế độ chuyển đổi WPA3 cho phép cả các thiết bị khách hỗ trợ WPA2 và WPA3 kết nối trên cùng một SSID. Điều này được thực hiện bằng cách phát sóng tín hiệu của SSID được cấu hình ở chế độ chuyển đổi WPA3 với cả hai khả năng WPA2 và WPA3 như hình bên dưới. AP quảng cáo cả hai loại bộ AKM 00:0f:ac-6 cho PSK và 00:0f:AC-8 cho SAE, tuy nhiên điều này làm cho PMF của SSID chỉ là tùy chọn chứ không phải bắt buộc.
</div>

![H1](assets/img/wifi/rtaImage6.avif)


## WPA3-Enterprise: Bảo mật nâng cao

<div style="text-align: justify; text-indent: 2em;">
Dựa trên WPA2-Enterprise, WPA3-Enterprise cung cấp WPA3-Enterprise 192-bit, một chế độ tùy chọn an toàn hơn. Chế độ này cung cấp các biện pháp bảo vệ an ninh sau:
</div>

<div style="text-align: justify; text-indent: 2em;">
Bảo vệ dữ liệu: Bộ mã hóa bảo mật Suite-B 192 bit được sử dụng. So với khóa 128 bit được WPA2 sử dụng, bộ mã hóa này tăng độ dài khóa lên 192 bit, giúp tăng cường hơn nữa khả năng bảo vệ mật khẩu.
</div>

<div style="text-align: justify; text-indent: 2em;">
Bảo vệ khóa: Thuật toán HMAC-SHA-384 an toàn hơn được sử dụng để xuất và xác nhận khóa trong giai đoạn bắt tay 4 bước. (HMAC: mã xác thực thông điệp dựa trên hàm băm; SHA: thuật toán băm an toàn)
</div>

<div style="text-align: justify; text-indent: 2em;">
Bảo vệ lưu lượng: Giao thức Galois-Counter Mode Protocol-256 (GCMP-256) an toàn hơn được sử dụng để bảo vệ lưu lượng không dây sau khi các thiết bị đầu cuối (STA) hoạt động trực tuyến.
</div>

<div style="text-align: justify; text-indent: 2em;">
Khung quản lý được bảo vệ (PMF): Mã xác thực thông báo Galois-256 (GMAC-256) của GCMP được sử dụng để bảo vệ các khung quản lý đaicast.
</div>

## Xác thực OWE: Bảo vệ mạng mở

<div style="text-align: justify; text-indent: 2em;">
Hầu hết các mạng Wi-Fi tại các địa điểm công cộng, như sân bay, nhà ga và quán cà phê, đều sử dụng chế độ xác thực mở truyền thống. Với OWE, người dùng có thể truy cập mạng Wi-Fi mà không cần nhập mật khẩu, và dữ liệu được truyền giữa người dùng và mạng Wi-Fi không được mã hóa. Điều này làm tăng nguy cơ truy cập mạng trái phép.
</div>

<div style="text-align: justify; text-indent: 2em;">
WPA3 giới thiệu chế độ xác thực mạng mở nâng cao (OWE) cho các mạng mở. Điều này cho phép người dùng truy cập mạng mà không cần nhập mật khẩu, tạo điều kiện thuận lợi cho người dùng truy cập vào các mạng Wi-Fi mở. Ngoài ra, OWE sử dụng thuật toán trao đổi khóa Diffie-Hellman để trao đổi khóa giữa người dùng và thiết bị Wi-Fi, mã hóa dữ liệu được truyền tải và bảo vệ an ninh dữ liệu người dùng.
</div>

<div style="text-align: justify; text-indent: 2em;">
</div>

## Documents

<a href="/assets/documents/wifi/WPA3 Specification v3.3.pdf" target="_blank">WPA3 Specification</a><br>

## References

[1] https://info.support.huawei.com/info-finder/encyclopedia/en/WPA3.html