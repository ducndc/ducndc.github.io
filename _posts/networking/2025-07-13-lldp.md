---
layout: post
title: "Link Layer Discovery Protocol (LLDP)"
date: 2025-07-14 10:00:00 +0700
categories: [Networking]
tags: [networking, lldp, protocol, layer-2, discovery, ieee-802, network-management]
excerpt: "A detailed look at LLDP — the IEEE 802 standard for neighbor discovery — covering frame encapsulation, message format, TLV structure, and protocol operation."
---

Network management depends on knowing the physical topology: which devices are connected to which ports, and how to reach them. LLDP provides a standardized, vendor-neutral way for network devices to advertise themselves to their directly connected neighbors — making it the foundation for topology discovery in modern managed networks.

## What is LLDP?

The **Link Layer Discovery Protocol (LLDP)** is a media-independent protocol designed to run on all IEEE 802 devices. An LLDP agent learns management reachability and connection endpoint information from adjacent devices, enabling network management systems (NMS) to build an accurate picture of the physical topology.

Key characteristics:

- Operates at **Layer 2 only** — two systems running different network-layer protocols can still discover each other
- Runs on all IEEE 802 media (Ethernet, Wi-Fi, etc.)
- Each device sends **periodic LLDP messages** out every LLDP-enabled port and listens for messages on the same ports
- Each message carries a **time-to-live (TTL)** value; recipients discard topology information when it expires
- Each message identifies the **source port** as a connection endpoint and includes at least one network address the NMS can use to reach a management agent on the device

---

## Frame Encapsulation

An LLDP PDU is carried inside an IEEE 802 Slow Protocol frame:

![LLDP frame encapsulation](/assets/img/networking/FrameEncapsulation.png)

| Field | Value | Notes |
|-------|-------|-------|
| **Destination MAC** | `01-80-C2-00-00-02` | Slow Protocols multicast address; not forwarded by 802-compliant bridges |
| **Source MAC** | Sending station's MAC | — |
| **EtherType** | `88-09` | Identifies the frame as a Slow Protocol |
| **Subtype** | Protocol-specific | Reserved fields set to zero |

The destination address `01-80-C2-00-00-02` falls within the range reserved by ISO/IEC 15802-3 for link-constrained protocols. This ensures LLDP frames stay local — they will never be forwarded across a bridge, keeping discovery strictly between adjacent devices.

---

## LLDP Message Format

Each LLDP PDU is transmitted in a single 802 frame and consists of a fixed header followed by a variable number of TLV (Type-Length-Value) attributes.

### Header

The LLDP header is 4 bytes, in network byte order:

![LLDP header format](/assets/img/networking/LLDPFormat.png)

| Field | Size | Description |
|-------|------|-------------|
| **Version** | 1 byte | Protocol version; set to `0x01` |
| **Flags** | 1 byte | Reserved for future extensions; must be `0x00` in version 1 messages |
| **Time to Live** | 2 bytes | Seconds the recipient should treat this information as valid; range 0–65535 |

The TTL is calculated by the sending agent as:

```
TTL = min(65535, LLDPMessageTxInterval × LLDPMessageTxHoldMultiplier)
```

A TTL of zero is a special signal — it means the sending port is shutting down and the recipient should immediately remove all topology information learned from that agent.

### TLV Format

Following the header are one or more TLVs:

![TLV format](/assets/img/networking/tlv_lldp.png)

| Field | Size | Description |
|-------|------|-------------|
| **Type** | 2 bytes | Integer identifying the kind of information in this TLV |
| **Length** | 2 bytes | Length of the Value field in octets |
| **Value** | Variable | Instance-specific data for this TLV |

TLVs are always 4-octet aligned; pad bytes are appended to the *previous* TLV to align the next one, and are not counted in the Length field.

---

## Standard TLV Definitions

![TLV summary table](/assets/img/networking/tlv_sum.png)

### Chassis ID *(mandatory)*

Identifies the chassis component of the endpoint associated with the transmitting agent.

![Chassis ID TLV format](/assets/img/networking/chassid.png)

| Sub-field | Description |
|-----------|-------------|
| **Chassis ID Type** | Enumerates the format and source of the identifier, as defined by `PtopoChassisIdType` in RFC 2922 |
| **Chassis ID String** | Binary string containing the actual chassis identifier, as defined by `PtopoChassisId` in RFC 2922 |

### Port ID *(mandatory, optional for 802.3 Repeater ports)*

Identifies the specific port from which the LLDP PDU was transmitted.

![Port ID TLV format](/assets/img/networking/port_id.png)

| Sub-field | Description |
|-----------|-------------|
| **Port ID Type** | Enumerates the format and source of the identifier, as defined by `PtopoPortIdType` in RFC 2922 |
| **Port ID String** | Binary string containing the port identifier, as defined by `PtopoPortId` in RFC 2922 |

### Management Address *(mandatory)*

Provides a network address that an NMS can use to reach a management agent on the device via the port identified in the Port ID TLV.

![Management Address TLV format](/assets/img/networking/ManagementAddressTLVFormat.png)

| Sub-field | Description |
|-----------|-------------|
| **IANA Address Family** | Identifies the address type (e.g., IPv4, IPv6), as defined in RFC 3232 |
| **Address Length** | Number of octets in the address field |
| **Address** | Binary string containing the management address |

### Vendor-Specific *(optional)*

Allows vendors to encode proprietary attributes not suitable for standardization.

![Vendor-Specific TLV format](/assets/img/networking/VendorID.png)

| Sub-field | Description |
|-----------|-------------|
| **Vendor-ID** | 3-byte SMI Network Management Private Enterprise Code (high-order octet is `0x00`), as defined in RFC 3232 |
| **String** | Vendor-defined data; implementations should treat it as opaque octets. Multiple sub-attributes may be encoded within a single TLV. |

LLDP agents that don't understand a received vendor-specific TLV must ignore it. Agents that don't receive expected vendor-specific data should attempt to operate normally (possibly in a degraded mode) and should report the absence.

---

## Protocol Operation

An active LLDP agent is responsible for six functions:

- Transmitting LLDP messages on all enabled ports
- Processing received LLDP messages
- Maintaining a local instance of the LLDP MIB
- Maintaining a local instance of the PTOPO MIB
- Maintaining appropriate `ifEntry` and/or `entPhysicalEntry` instances
- Implementing `ifAlias` and/or `entPhysicalAlias` MIB objects

### Initialization

On startup, the agent:

1. Loads non-volatile LLDP MIB configuration, or applies default values if none exists.
2. Checks `LLDPAdminStatus`. If set to `disabled(2)`, initialization halts until the status is changed to `enabled(1)`.
3. Initializes internal data structures with local physical topology information and transmission parameters.

### Message Transmission

LLDP messages must follow IEEE 802.3 Slow Protocols transmission rules. Beyond that:

- The agent transmits one LLDP message per port, per message interval (`LLDPMessageTxInterval`).
- Transmission intervals should be **jittered** to prevent multiple devices from synchronizing and flooding the network simultaneously.
- Before transmitting on a port, the agent checks the `LLDPSuppressTable`. If the port appears there, transmission is skipped.
- Each transmitted frame has its MAC header filled with the appropriate SA, DA (`01-80-C2-00-00-02`), and EtherType (`88-09`).
- The `LLDPStatsOutPkts` counter is incremented for each transmitted message.

Each message must include all three mandatory TLVs (Chassis ID, Port ID, Management Address). Additional TLVs may be appended up to the maximum frame size.

### Message Forwarding

LLDP is designed to be **non-forwarding** in most cases:

- **Non-forwarding agents** (routers, bridges): process received LLDP messages locally and do not retransmit them on any other port.
- **Forwarding agents** (repeaters): cannot inspect individual frames before retransmitting, so LLDP messages may be forwarded. These devices also send their own LLDP messages on the same ports.

An NMS may encounter topology entries for the same physical port from multiple LLDP agents when forwarding and non-forwarding agents are mixed in a network segment.

### Message Reception

On receiving an LLDP frame, the agent:

1. Validates the LLDP version (`0x01`) and flags (`0x00`). If either is wrong, `LLDPStatsInErrors` is incremented and the frame is discarded.
2. Decodes the TLV section. If encoding is malformed, `LLDPStatsInErrors` is incremented and processing stops.
3. Verifies all mandatory TLVs are present. Unknown TLVs are skipped; missing mandatory TLVs increment `LLDPStatsInErrors`.
4. Increments `LLDPStatsInGoodPkts` for valid messages.
5. Updates the PTOPO MIB accordingly (see below).

### PTOPO MIB Update

After a valid message passes all receive checks:

- If TTL is **zero**: execute the interface shutdown procedure — remove all topology information learned from the sending agent on the indicated port.
- If TTL is **non-zero**: find or create the appropriate `ptopoConnEntry` based on the message's data elements. Update `ptopoConnLastVerifyTime` with the current `sysUpTime` for dynamic entries.

If any `ptopoConnEntry` was added, deleted, or modified (beyond just timestamp updates), `ptopoLastChangeTime` is updated and a `ptopoConfigChange` trap is generated.

### Graceful Shutdown

When a port is about to go non-operational (disabled administratively or LLDP is being turned off), the agent transmits a **final LLDP message with TTL = 0** before the interface goes down. This tells the neighbor to immediately invalidate the topology information it learned from this port, rather than waiting for the normal TTL expiry.

If the entire LLDP agent is transitioning to disabled state, the shutdown procedure runs for all local interfaces.

---

## References

1. [LLDP Protocol Specification (IEEE 802.1)](https://www.ieee802.org/1/files/public/docs2002/lldp-protocol-00.pdf)
2. RFC 2922 — Physical Topology MIB
3. RFC 3232 — Assigned Numbers