---
layout: post
title: "Dynamic Host Configuration Protocol"
date: 2025-07-23 10:00:00 +0700
categories: [Networking]
---

## Overview

<div style="text-align: justify; text-indent: 2em;">
The Dynamic Host Configuration Protocol (DHCP) is a network management protocol used on Internet Protocol (IP) networks for automatically assigning IP addresses and other communication parameters to devices connected to the network using a client–server architecture.
</div>

## Protocol

<div style="text-align: justify; text-indent: 2em;">
The figure below with a Switch, WLC, AP & DHCP server(Microsoft DHCP server on a VM). Switch has been configured with basic SVI interfaces with listed gateway addresses.
</div>

![H1](/assets/img/networking/dhcp1-00.webp)

###  DHCP discovery

<div style="text-align: justify; text-indent: 2em;">
The figure below illustrates how DHCP works in wired environment by capturing wireshark packets of  wired PC Ethernet interface while it is acquiring an IP from DHCP server. As you can see there are 4 type of packets (Discover, Offer, Request, ACK  ie DORA) exchanged prior to PC get an IP.
</div>

![H1](/assets/img/networking/dhcp1-03.png)

<div style="text-align: justify; text-indent: 2em;">
As you can see in layer 4 it use UDP protocol with src port 68 & des port 67 which is bootpc (client) & bootps(server). Actually DHCP is an extension of BootP protocol. This discovery msg include certain options (53, 61,12,60,55) sometimes these field used to identify the client to DHCP server. In layer 3 src would be 0.0.0.0 (as not yet aquire an IP) & dst (255.255.255.255) would be all subnet broadcast. In layer 2 src MAC would be PC’s NIC mac address where as dst MAC would be broadcast MAC.
</div>

![H1](/assets/img/networking/dhcp1-011.png)

<div style="text-align: justify; text-indent: 2em;">
This layer 2 broadcast message would go to all host in that subnet & will reach the switch SVI (int vlan 13-GW). Since DHCP server is in a different subnet (vlan 200) this DHCP discover msg will not reach that(broadcast will limited only to local subnet). Then DHCP server will send a DHCP offer msg.
</div>

###  DHCP offer 

<div style="text-align: justify; text-indent: 2em;">
As switch acting as DHCP-Relay (note that int vlan 13 IP of the switch listed as relay-agent IP in this packet) it will receive the DHCP offer msg from DHCP server & then send to client. This packet includes Bootp options like IP address, subnet mask, lease time, DHCP server IP, domain name, default gateway,etc.  UDP src port would be 67 (as coming from server) & dst port would be 68 (to client). In layer 3, switch will set its vlan 13 IP address as src IP of this packet & dst IP would be layer 3 broadcast (255.255.255.255). In layer 2 it will go as a broadcast frame.
</div>

![H1](/assets/img/networking/dhcp1-021.webp)

### DHCP request 

<div style="text-align: justify; text-indent: 2em;">
Once client receive this offer message, it will send a DCHP request message for asking that IP. By this time client knows what was “offered client IP” in the DHCP offer & therefore “Request msg” include that IP (10.10.13.10 in this case). Also it lists DHCP server address (in this way even multiple DHCP servers responded, client can choose which DHCP server to ask for IP). Since traffic is going from client, UDP src port would be 68 & dst port would be 67. Still layer 3 src would be 0.0.0.0 & dst 255.255.255.255. In layer two this will go as broadcast.
</div>

![H1](/assets/img/networking/dhcp1-031.webp)

### DHCP ack

<div style="text-align: justify; text-indent: 2em;">
Finally client will get DHCP ACK, confirming it can use this requested IP. Still this packet dst IP is layer 3 broadcast (as client does not has IP) & hence layer 2 frame go as a broadcast as well.
</div>

![H1](/assets/img/networking/dhcp1-04.webp)

<div style="text-align: justify; text-indent: 2em;">
Once client get this frame & process he could confirm his MAC address listed as client MAC in bootp field. Then it will assign the given IP to NIC. As you can see next thing it will do is send an ARP request to find what is his gateway’s (10.10.13.1 listed in bootp options) MAC address. Then client know everything (layer 2 & 3) to communicate with the rest of the network.
</div>

## References

[1] https://mrncciew.com/2012/12/27/understanding-dhcp/
